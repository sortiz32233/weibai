var Manager={init:function(){var a=this;a.validate(),a.bind()},bind:function(){var a=this;$(document).on("click",".Jdelete",function(){var e=$(this);Modal.confirm({id:"Jconfirm",content:"确定要删除该用户？",callback:function(){App.blockUI($("#Jconfirm")),a.deleteUser(e.data("id"))}})}).on("click",".Jreset",function(){var e=$(this);Modal.confirm({id:"Jconfirm",content:"确定要重置该用户的密码？",callback:function(){App.blockUI($("#Jconfirm")),a.resetPassword(e.data("id"))}})}).on("click","#Jadd",function(){Modal.template({id:"Jtemplate",title:"添加用户",content:a._template({iType:0,managerId:"",sName:"",sTrueName:""}),callback:function(){App.blockUI($("#Jtemplate")),a.handleUser()}})}).on("click",".Jedit",function(){var e=$(this);Modal.template({id:"Jtemplate",title:"修改用户信息",content:a._template({iType:1,managerId:e.data("id"),sName:e.data("name"),sTrueName:e.data("truename")}),callback:function(){App.blockUI($("#Jtemplate")),a.handleUser()}})}).on("click",".Jcontrol",function(){var e=$(this),t="",n=e.data("lock");t=n?"锁定":"解锁",Modal.confirm({id:"Jconfirm",content:"确定要"+t+"该用户？",callback:function(){App.blockUI($("#Jconfirm")),a.controlUser({managerId:e.data("id"),isLock:n,json:1})}})})},postData:function(a){try{$.ajax({url:a.url||"",data:a.data,type:a.type||"get",dataType:"json",success:function(e){a.callback(e)},error:function(a){console.error("异常....")},complete:function(){App.unblockUI(a.hObject)}})}catch(a){console.error(a)}},handleUser:function(){$("#Juserform").validate().form()&&this.postData({url:"/manager/action",type:"post",data:$("#Juserform").serialize(),hObject:$("#Jtemplate"),callback:function(a){"success"==a.status?Modal.alert({id:"Jalert",content:a.msg,type:"success",callback:function(){window.location.reload()}}):Modal.alert({id:"Jalert",type:"error",content:a.msg,callback:function(){}})}})},controlUser:function(a){this.postData({url:"/manager/lock",type:"post",data:a,hObject:$("#Jconfirm"),callback:function(a){"success"==a.status?Modal.alert({id:"Jalert",content:a.msg,type:"success",callback:function(){window.location.reload()}}):Modal.alert({id:"Jalert",type:"error",content:a.msg,callback:function(){}})}})},deleteUser:function(a){this.postData({url:"/manager/delete",type:"post",data:{managerId:a,json:1},hObject:$("#Jconfirm"),callback:function(a){"success"==a.status?Modal.alert({id:"Jalert",content:a.msg,type:"success",callback:function(){window.location.reload()}}):Modal.alert({id:"Jalert",type:"error",content:a.msg,callback:function(){}})}})},resetPassword:function(a){this.postData({url:"/manager/resetpassword",type:"post",data:{managerId:a,json:1},hObject:$("#Jconfirm"),callback:function(a){"success"==a.status?Modal.alert({id:"Jalert",content:a.msg,type:"success",callback:function(){}}):Modal.alert({id:"Jalert",type:"error",content:a.msg,callback:function(){}})}})},_template:function(a){var e='<form id="Juserform" action="#" class="form-horizontal">                        <input type="hidden" name="isEdit" value="'+a.iType+'" />                        <input type="hidden" name="json" value="1" />                        <input type="hidden" name="managerId" value="'+a.managerId+'" />                        <div class="alert alert-error hide">                            <button class="close" data-dismiss="alert"></button>                            <span>请输入您的用户名及密码</span>                        </div>                        <div class="control-group">                            <label class="control-label"><i class="icon-user"></i>用户名：</label>                            <div class="controls">                                <input id="JmanagerName" name="managerName" type="text" class="span6 m-wrap" palaceholder="请输入用户名" value="'+a.sName+'"/>                            </div>                        </div>                        <div class="control-group">                            <label class="control-label"><i class="icon-user-md"></i>真实姓名：</label>                            <div class="controls">                                <input id="JtrueName" name="trueName" type="text" class="span6 m-wrap" palaceholder="请输入真实姓名" value="'+a.sTrueName+'"/>                            </div>                        </div>                        <div class="control-group">                            <label class="control-label"><i class="icon-lock"></i>密码：</label>                            <div class="controls">                                <input id="Jpassword" name="password" type="password" class="span6 m-wrap" palaceholder="请输入密码" />                            </div>                        </div>';return a.iType?e+="</form>":e+='<div class="control-group">                            <label class="control-label"><i class="icon-lock"></i>确认密码：</label>                            <div class="controls">                                <input id="JpasswordAgain" type="password" class="span6 m-wrap" palaceholder="请再次输入密码" />                            </div>                        </div>                    </form>',e},validate:function(){$("#Juserform").validate({errorElement:"label",errorClass:"help-inline",focusInvalid:!1,rules:{username:{required:!0},password:{required:!0}},messages:{username:{required:"请输入用户名"},password:{required:"请输入密码"}},invalidHandler:function(a,e){$(".alert-error",$("#Juserform")).show()},highlight:function(a){$(a).closest(".control-group").addClass("error")},success:function(a){a.closest(".control-group").removeClass("error"),a.remove()},errorPlacement:function(a,e){a.addClass("help-small no-left-padding").insertAfter(e.closest(".input-icon"))},submitHandler:function(a){}})}};$(function(){Manager.init()});