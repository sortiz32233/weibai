var Manager={$userForm:null,$template:null,init:function(){this.bind()},bind:function(){var a=this;$(document).on("click",".Jdelete",function(){var e=$(this);Modal.confirm({id:"Jconfirm",content:"确定要删除该用户？",callback:function(){a.deleteUser(e.data("id"))}}),a.$template=$("#Jconfirm")}).on("click",".Jreset",function(){var e=$(this);Modal.confirm({id:"Jconfirm",content:"确定要重置该用户的密码？",callback:function(){a.resetPassword(e.data("id"))}}),a.$template=$("#Jconfirm")}).on("click",".Joperate",function(){var e=$(this),t="",r=e.data("type");t=r?"修改用户信息":"添加用户",Modal.template({id:"Jtemplate",title:t,content:a._template({iType:r,managerId:e.data("id"),sName:e.data("name"),sTrueName:e.data("truename")}),callback:function(){a.handleUser()}}),a.$template=$("#Jtemplate"),a.$userForm=$("#JuserForm"),a.$userForm.find(".alert-error button").click(function(){$(this).parent().hide()}),$("#JtemplateBtn").removeData("dismiss").removeAttr("data-dismiss"),a.validate()}).on("click",".Jcontrol",function(){var e=$(this),t="",r=e.data("lock");t=r?"锁定":"解锁",Modal.confirm({id:"Jconfirm",content:"确定要"+t+"该用户？",callback:function(){a.controlUser({managerId:e.data("id"),isLock:r,json:1})}}),a.$template=$("#Jconfirm")})},postData:function(a){try{$.ajax({url:a.url||"",data:a.data,type:a.type||"get",dataType:"json",beforeSend:function(){App.blockUI(a.hObject)},success:function(e){a.callback(e)},error:function(a){console.error("异常....")},complete:function(){App.unblockUI(a.hObject)}})}catch(a){console.error(a)}},handleUser:function(){var a=this;a.$userForm.validate().form()&&a.postData({url:"/manager/action",type:"post",data:a.$userForm.serialize(),hObject:a.$template.find(".Jload"),callback:function(e){"success"==e.status?(a.$template.modal("hide"),Modal.alert({id:"Jalert",content:e.msg,type:"success",callback:function(){window.location.reload()}})):a.$userForm.find(".alert-error").show().find("span").html(e.msg)}})},controlUser:function(a){var e=this;e.postData({url:"/manager/lock",type:"post",data:a,hObject:e.$template.find(".Jload"),callback:function(a){"success"==a.status?Modal.alert({id:"Jalert",content:a.msg,type:"success",callback:function(){window.location.reload()}}):Modal.alert({id:"Jalert",type:"error",content:a.msg,callback:function(){}})}})},deleteUser:function(a){var e=this;e.postData({url:"/manager/delete",type:"post",data:{managerId:a,json:1},hObject:e.$template.find(".Jload"),callback:function(a){"success"==a.status?Modal.alert({id:"Jalert",content:a.msg,type:"success",callback:function(){window.location.reload()}}):Modal.alert({id:"Jalert",type:"error",content:a.msg,callback:function(){}})}})},resetPassword:function(a){var e=this;e.postData({url:"/manager/resetpassword",type:"post",data:{managerId:a,json:1},hObject:e.$template.find(".Jload"),callback:function(a){"success"==a.status?Modal.alert({id:"Jalert",content:a.msg,type:"success",callback:function(){}}):Modal.alert({id:"Jalert",type:"error",content:a.msg,callback:function(){}})}})},_template:function(a){var e='<form id="JuserForm" action="#" class="form-horizontal">                        <input type="hidden" name="isEdit" value="'+a.iType+'" />                        <input type="hidden" name="json" value="1" />                        <input type="hidden" name="managerId" value="'+a.managerId+'" />                        <div class="alert alert-error hide">                            <button class="close" type="button"></button>                            <span>请完善相关信息</span>                        </div>                        <div class="control-group">                            <label class="control-label"><i class="icon-user"></i>用户名：</label>                            <div class="controls">                                <input id="managerName" name="managerName" type="text" class="span6 m-wrap" palaceholder="请输入用户名" value="'+a.sName+'"/>                            </div>                        </div>                        <div class="control-group">                            <label class="control-label"><i class="icon-user-md"></i>真实姓名：</label>                            <div class="controls">                                <input id="trueName" name="trueName" type="text" class="span6 m-wrap" palaceholder="请输入真实姓名" value="'+a.sTrueName+'"/>                            </div>                        </div>';return a.iType?e+="</form>":e+='<div class="control-group">                            <label class="control-label"><i class="icon-lock"></i>密码：</label>                            <div class="controls">                                <input id="password" name="password" type="password" class="span6 m-wrap" palaceholder="请输入密码" />                            </div>                        </div>                        <div class="control-group">                            <label class="control-label"><i class="icon-lock"></i>确认密码：</label>                            <div class="controls">                                <input name="confirm_password" type="password" class="span6 m-wrap" palaceholder="请再次输入密码" />                            </div>                        </div>                    </form>',e},validate:function(){var a=this;a.$userForm.validate({errorElement:"label",errorClass:"help-inline",focusInvalid:!1,rules:{managerName:{required:!0},trueName:{required:!0},password:{required:!0,rangelength:[6,10]},confirm_password:{required:!0,equalTo:"#password"}},messages:{managerName:{required:"请输入用户名"},trueName:{required:"请输入您的真实姓名"},password:{required:"请输入密码",rangelength:$.validator.format("密码由{0}至{1}位字符组成")},confirm_password:{required:"请再次输入密码",equalTo:"两次密码不一致"}},invalidHandler:function(e,t){$(".alert-error",a.$userForm).show()},highlight:function(a){$(a).closest(".control-group").addClass("error")},success:function(a){a.closest(".control-group").removeClass("error"),a.remove()},errorPlacement:function(a,e){a.addClass("help-small no-left-padding").insertAfter(e.closest(".span6.m-wrap"))},submitHandler:function(a){return!1}})}};$(function(){Manager.init()});