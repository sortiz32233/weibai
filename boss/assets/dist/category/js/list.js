var Category={wangEditor:null,init:function(){this.bind()},intWangEditor:function(){var t=this;t.wangEditor=new wangEditor("editor-trigger"),t.wangEditor.config.uploadImgUrl="/upload/index?action=edimage",t.wangEditor.config.uploadImgFileName="upfile",t.wangEditor.create()},bind:function(){var t=this;$(document).on("click",".Jedit",function(){t.showEditForm($(this).data("id"))}).on("click","#cancelEdit",function(){$("#categoryForm").hide()}).on("click","#saveEdit",function(){t.saveEditFormData()}).on("click",".Jdelete",function(){var o=$(this);Modal.confirm({id:"Jmodal",content:"确定要删除该条记录？",callback:function(){App.blockUI($("#Jmodal")),t.deleteOne(o.data("id"))}})}).on("click","#addNews",function(){t.showAddForm()})},postData:function(t){try{$.ajax({url:t.url||"",data:t.data,type:t.type||"get",dataType:"json",beforeSend:function(){},success:function(o){null!=t.callback&&t.callback(o)},error:function(t){},complete:function(t){}})}catch(t){console.error(t)}},showEditForm:function(t){var o=Category,a={categoryId:t,json:1},e={url:"/category/getOneCategoryById",data:a,callback:o.setEditFormData};o.postData(e)},setEditFormData:function(t){if("error"==t.status)Modal.alert({id:"Jalert",content:"内部错误！",type:"error",callback:function(){window.location.reload()}});else try{var o=t.data.category,a=t.data.pCategorys;if(o){if(0==o.pid)$("#JfpCategoryControl").hide();else{$("#JFormCategoryParent").empty();for(var e="<option value='0'>请选择一级类目</option>",n=0;n<a.length;n++){var r=a[n];o.pid==r.id?e+="<option selected='selected' value="+r.id+">"+r.name+"</option>":e+="<option value="+r.id+">"+r.name+"</option>"}$("#JFormCategoryParent").append(e)}$("#name").val(o.name),$("#des").val(o.des),$("#showSort").val(o.show_sort),$("#categoryId").val(o.id),$("#cmsUrl").val(o.hyperlink),$("#categoryForm").show()}}catch(t){console.error(t)}},saveEditFormData:function(){var t=this,o=$("#categoryId").val(),a=0;o>0&&(a=1),t.postData({url:"/category/actionCategory?isEdit="+a,data:$("#Jnewform").serialize(),type:"post",callback:function(t){"success"==t.status?Modal.alert({id:"Jalert",content:"操作成功！",type:"success",callback:function(){window.location.reload()}}):Modal.alert({id:"Jalert",type:"error",content:t.msg,callback:function(){}})}})},deleteOne:function(t){this.postData({url:"/category/delete",data:{categoryId:t,json:1},type:"post",callback:function(t){App.unblockUI($("#Jmodal")),"success"==t.status?Modal.alert({id:"Jalert",content:"删除成功！",type:"success",callback:function(){window.location.reload()}}):Modal.alert({id:"Jalert",type:"error",content:"删除失败，请稍后重试！",callback:function(){}})}})},showAddForm:function(){$("#categoryForm").show(),$(":input","#categoryForm").not(":button, :submit, :reset, :hidden").val("").removeAttr("checked").removeAttr("selected"),$("#JfpCategoryControl").show()}};$(function(){Category.init()});