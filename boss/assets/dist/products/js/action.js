var Action={init:function(){var e=this;e._upload(),e.bind()},bind:function(){$(document).on("click","#JmodifyPic",function(){var e=$(this);$("#JpicBtn").removeClass("v-hide"),e.parent().parent().remove()}).on("click",".pre-close",function(){$(this).parent().parent().remove()})},_upload:function(e){var n=$('<button class="JbtnUpload btn blue" disabled type="button">处理中...</button>').on("click",function(){var e=$(this),n=e.data();e.off("click").text("中断上传").on("click",function(){e.remove(),n.abort()}),n.submit().always(function(){e.next("button").remove(),e.remove()})}),t=$("<button style='margin-left: 8px;' class='btn red' type='button'><i class='icon-trash'></i> 删除</button>").on("click",function(){$(this).parent().parent().remove()});$("#JuploadPic").fileupload({url:"/upload/index?action=pdimage&json=1",dataType:"json",autoUpload:!1,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxNumberOfFiles:1,maxFileSize:999e3,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),previewMaxWidth:100,previewMaxHeight:100,previewCrop:!0}).on("fileuploadadd",function(e,i){var a=$(i.fileInputClone[0]).data("show");i.context=$("<div/>").appendTo($(a)),$.each(i.files,function(e,a){var o=$("<p/>").append($("<span/>").text(a.name));e||(o.append(n.clone(!0).data(i)),o.append(t.clone(!0).on("click",function(){$("#JpicBtn").removeClass("v-hide")}))),o.appendTo(i.context)}),$("#JpicBtn").addClass("v-hide")}).on("fileuploadprocessalways",function(e,n){var t=n.index,i=n.files[t],a=$(n.context.children()[t]);i.preview&&a.prepend("<br>").prepend(i.preview),i.error&&a.append("<br>").append($('<span class="text-danger"/>').text(i.error)),t+1===n.files.length&&n.context.find(".JbtnUpload").html('<i class="icon-upload"></i> 上传').prop("disabled",!!n.files.error)}).on("fileuploaddone",function(e,n){if("success"===n.result.status){var t=$("<i class='pre-close'>x</i>").on("click",function(){$("#JpicBtn").removeClass("v-hide")}),i="<img src='"+n.result.minUrl+"'><input type='hidden' name='imgUrl[]' value='"+n.result.bgUrl+"'>";$(n.context.children()).append(i),$(n.context.children()).append(t),$(n.context).find("span").remove()}}).on("fileuploadfail",function(e,n){$.each(n.files,function(e){var t=$('<span class="text-danger"/>').text("File upload failed.");$(n.context.children()[e]).append("<br>").append(t)})}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled"),$(".JuploadDoc").fileupload({url:"/upload/index?action=pdoc&json=1",dataType:"json",autoUpload:!1,acceptFileTypes:/(\.|\/)(doc|docx|pdf|xls|xlsx)$/i,maxNumberOfFiles:1,maxFileSize:999e3,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),previewMaxWidth:100,previewMaxHeight:100,previewCrop:!0}).on("fileuploadadd",function(e,i){var a=$(i.fileInputClone[0]),o=a.data("show");i.context=$("<div/>").appendTo($(o)),i.linkType=a.data("ptype"),$.each(i.files,function(e,a){var o=$("<p/>").append($("<span/>").text(a.name));e||(o.append(n.clone(!0).data(i)),o.append(t.clone(!0))),o.appendTo(i.context)})}).on("fileuploadprocessalways",function(e,n){var t=n.index,i=n.files[t],a=$(n.context.children()[t]);i.preview&&a.prepend("<br>").prepend(i.preview),i.error&&a.append("<br>").append($('<span class="text-danger"/>').text(i.error)),t+1===n.files.length&&n.context.find(".JbtnUpload").html('<i class="icon-upload"></i> 上传').prop("disabled",!!n.files.error)}).on("fileuploaddone",function(e,n){if("success"===n.result.status){var t=$("<i class='pre-close'>x</i>"),i="<input type='hidden' name='productRelationsPath["+n.linkType+"][]' value='"+n.result.url+"'/><input type='hidden' name='productRelationsTitle["+n.linkType+"][]' value='"+n.result.name+"'/>";$(n.context.children()).append(i),$(n.context.children()).append(t)}}).on("fileuploadfail",function(e,n){$.each(n.files,function(e){var t=$('<span class="text-danger"/>').text("File upload failed.");$(n.context.children()[e]).append("<br>").append(t)})}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}};$(function(){Action.init()});